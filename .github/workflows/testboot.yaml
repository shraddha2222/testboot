name: Deploy Spring Boot
on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Manual trigger button

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Cleanup
      run: rm -rf app target *.jar
      
    - name: Install Dependencies
      run: sudo apt-get update && sudo apt-get install -y maven java-17-openjdk git 
      
    - name: Fetch Public Spring Boot Repo
      run: |
        git clone https://github.com/bratzelk/spring-boot-hello-world.git ./app
        cd app && ls -la
        
    - name: Build Spring Boot JAR
      run: |
        cd app
        mvn clean package -DskipTests
        ls -la target/
        
    - name: Deploy Service
      run: |
        sudo cp app/target/*.jar /opt/springboot-app/app.jar
        sudo systemctl restart springboot-app
        sleep 15
